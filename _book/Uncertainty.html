<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Section 4 Quantifying Uncertainty | Online Companion to Archaeological Network Science</title>
<meta name="author" content="Matthew A. Peeples and Tom Brughmans">
<meta name="description" content="In almost any archaeological network study, the networks we create are incomplete (i.e., we know that we are missing nodes or edges for various reasons: site destruction, lack of survey coverage,...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Section 4 Quantifying Uncertainty | Online Companion to Archaeological Network Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://book.archnetworks.net/Uncertainty.html">
<meta property="og:image" content="https://book.archnetworks.net/images/cover.png">
<meta property="og:description" content="In almost any archaeological network study, the networks we create are incomplete (i.e., we know that we are missing nodes or edges for various reasons: site destruction, lack of survey coverage,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Section 4 Quantifying Uncertainty | Online Companion to Archaeological Network Science">
<meta name="twitter:description" content="In almost any archaeological network study, the networks we create are incomplete (i.e., we know that we are missing nodes or edges for various reasons: site destruction, lack of survey coverage,...">
<meta name="twitter:image" content="https://book.archnetworks.net/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Online Companion to <em>Archaeological Network Science</em></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="GettingStarted.html">Gettings Started with R</a></li>
<li><a class="" href="DataAndWorkspace.html"><span class="header-section-number">1</span> Data and Workspace Setup</a></li>
<li><a class="" href="NetworkData.html"><span class="header-section-number">2</span> Network Data in R</a></li>
<li><a class="" href="Exploratory.html"><span class="header-section-number">3</span> Exploratory Network Analysis</a></li>
<li><a class="active" href="Uncertainty.html"><span class="header-section-number">4</span> Quantifying Uncertainty</a></li>
<li><a class="" href="Visualization.html"><span class="header-section-number">5</span> Network Visualization</a></li>
<li><a class="" href="SpatialNetworks.html"><span class="header-section-number">6</span> Spatial Networks</a></li>
<li><a class="" href="BeyondTheBook.html"><span class="header-section-number">7</span> Going Beyond the Book</a></li>
<li><a class="" href="TableOfContents.html">Table of Contents Quick Reference</a></li>
<li><a class="" href="references-and-r-packages-1.html">References and R Packages</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mpeeples2008/Archaeological_Network_Science">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="Uncertainty" class="section level1" number="4">
<h1>
<span class="header-section-number">Section 4</span> Quantifying Uncertainty<a class="anchor" aria-label="anchor" href="#Uncertainty"><i class="fas fa-link"></i></a>
</h1>
<p>In almost any archaeological network study, the networks we create are incomplete (i.e., we know that we are missing nodes or edges for various reasons: site destruction, lack of survey coverage, looting, etc.). How might the fact that our networks are samples of a larger and typically unobtainable “total network” influence our interpretations of network structure and node position? In this section, we take inspiration from recent research in other areas of network research (Borgatti et al. 2006; Costenbader and Valente 2003; Smith and Moody 2013; Smith et al. 2017; Smith et al. 2022) and develop a means for assessing the impact of missing and poor quality information in our networks. This accompanies Chapter 5 of Brughmans and Peeples (2022) and we recommend that you read Chapter 5 as you work through the examples below.</p>
<p>For most of the other analyses presented in the book it is possible to use a number of different network software packages to conduct similar analyses. The analyses presented in Chapter 5, however, require the creation of custom scripts and procedures that are only possible in a programming language environment like R. We attempt here to not only provide information on how to replicate the examples in the book but also provide guidance on how you might modify the functions and code provided here for your own purposes.</p>
<div id="UncertaintyScripts" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> R Scripts and Custom Functions<a class="anchor" aria-label="anchor" href="#UncertaintyScripts"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter, we have created a number of relatively complex custom functions to conduct the assessments of network uncertainty outlined in Chapter 5. We provide step by step overviews of how these functions work below but it is useful to bundle the functions into .R script files and call them directly from the file when working with your own data.</p>
<p>The scripts described in detail below include:</p>
<ul>
<li>
<a href="scripts/sim_missing_nodes.R">sim_missing_nodes.R</a> - Assessments of the stability of centrality metrics for networks with nodes missing at random or due to a biased sampling process.</li>
<li>
<a href="scripts/sim_missing_edges.R">sim_missing_edges.R</a> -Assessments of the stability of centrality metrics for networks with edges missing at random or due to a biased sampling process.</li>
<li>
<a href="scripts/sim_missing_inc.R">sim_missing_inc.R</a> - Assessments of the stability of centrality metrics for networks with nodes missing at random or based on biased sampling from incidence matrix data.</li>
<li>
<a href="scripts/sim_target_node.R">sim_target_node.R</a> - Assessments of the stability in rank order position of a target node in networks with nodes missing at random or due to a biased sampling process.</li>
<li>
<a href="scripts/sim_samp_error.R">sim_samp_error.R</a> - Assessments of the stability centrality metrics due to sampling error in frequency data underlying similarity networks.</li>
<li>
<a href="scripts/edge_prob.R">edge_prob.R</a> - Functions for conducting edge probability modeling and plotting candidate networks and centrality distributions.</li>
</ul>
<p>Each of these are described in greater detail below along with an example. To run these scripts in R, you need to put them in your working directory and then use the <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> function. The <code>source</code> function will run all code within the .R file and initialize any functions they contain. For example:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"scripts/sim_missing_nodes.R"</span><span class="op">)</span></code></pre></div>
<p>Note that you must include the correct absolute or relative file path for the script to run properly.</p>
</div>
<div id="UncertaintyGeneral" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> A General Approach to Uncertainty<a class="anchor" aria-label="anchor" href="#UncertaintyGeneral"><i class="fas fa-link"></i></a>
</h2>
<p>As outlined in the book, our basic approach to quantifying and dealing with uncertainty is to use the sample we have as a means for understanding the robustness or vulnerability of the population from which that sample was drawn to the kinds of variability or perturbations we might expect. The procedures we outline primarily take the following basic form:</p>
<ul>
<li>Define a network based on the available sample, calculate the metrics and characterize the properties of interest in that network.</li>
<li>Derive a large number of modified samples from the network created in step 1 (or the underlying data) that simulate the potential data problem or sampling issue we are trying to address. For example, if we are interested in the impact of nodes missing at random, we could randomly delete some proportion of the nodes in each sample derived from the network created in step 1.</li>
<li>Calculate the metrics and characterize the properties of the features of interest in every one of the random samples created in step 2 and assess central tendency (mean, median) and distributional properties (range, standard deviation, distribution shape, etc.) or other features of the output as appropriate.</li>
<li>Compare the distributions of metrics and properties (at the graph, node, or edge level) from the random samples to the “original” network created in step 1 to assess the potential impacts of the perturbation or data treatment. This comparison between the properties of the network created in step 1 and the distribution of properties created in step 3 will provide information directly relevant to assessing the impact of the kind of perturbation created in step 2 on the original network sample and, by extension, the complete network from which it was drawn.</li>
</ul>
<p>The underlying assumption of the approach outlined here is that the robustness or vulnerability to a particular perturbation of the observed network data, drawn from a total network that is unattainable, provides information about the robustness or vulnerability of that unattainable complete network to the same kinds of perturbations. For example, if we are interested in exploring the degree distribution of a network and our sampling experiments show massive fluctuations in degree in sub-samples with only small numbers of nodes removed at random, this would suggest that the particular properties of this network are not robust to nodes missing at random for degree calculations. From this, we should not place much confidence in any results obtained from the original sample as indicative of the total network from which it was drawn. On the other hand, say we instead find that in the resampling experiments the degree distributions in our sub-samples are substantially similar to that of the original network sample even when moderate or large numbers of nodes are removed. In that case, we might conclude that our network structure is such that assessments of degree distribution are robust to node missigness within the range of what we might expect for our original sample. It is important to note, however, that this finding should not be transferred to any other metrics as any given network is likely to be robust to certain kinds of perturbations for certain network metrics, but not to others.</p>
</div>
<div id="NodesAtRandom" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Nodes Missing at Random<a class="anchor" aria-label="anchor" href="#NodesAtRandom"><i class="fas fa-link"></i></a>
</h2>
<p>This sub-section accompanies the discussion of nodes or edges missing at random in Brughmans and Peeples (2022) Chapter 5.3.1. Here we take one interval of the Chaco World ceramic similarity network (ca. A.D. 1050-1100) and simulate the impact of nodes missing at random on network centrality statistics. Download the <a href="data/AD1050net.csv">ceramic similarity adjacency matrix</a> to follow along.</p>
<p>The first thing we need to do is initialize our required libraries, import the network adjacency matrix, and convert it into a <code>igraph</code> network object. For several of the examples in this section we are using a simple undirected network though the code would also work for weighted or directed networks as well.</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com">ggraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://statnet.org">statnet</a></span><span class="op">)</span>

<span class="co"># Import adjacency matrix and covert to network</span>
<span class="va">chaco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'data/AD1050net.csv'</span>, row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">chaco_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">chaco</span><span class="op">)</span>,
                                                 mode <span class="op">=</span> <span class="st">"undirected"</span><span class="op">)</span></code></pre></div>
<p>First, following Chapter 5.3.1, we will assess the robustness of these data to nodes missing at random for betweenness and eigenvector centrality. In order to do this we need to define a function that removes a specified proportion of nodes at random, assesses the specified metric of interest, and compares each sub-sample to the original sample in terms of the rank order correlation (Spearman’s <span class="math inline">\(\rho\)</span>) among nodes for the metric in question.</p>
<p>To help you understand how this works, we first will walk through this example line by line for a single centrality measure so that you can see how this process is designed. Following that, we initialize <a href="scripts/sim_missing_nodes.R">a more complex script</a> which can conduct the same analysis for multiple measures and even accommodate biased sampling processes as we will see below.</p>
<p>Let’s start with the simple version. We have commented the code chunk below so that you can follow along with the process. We define two variables along the way:</p>
<ul>
<li>
<code>nsim</code> which is the number of simulations to conduct at each sampling fraction</li>
<li>
<code>props</code> which is a vector of sampling proportions to be test (0 &gt; value &lt; 1).</li>
</ul>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate node level metric of interest (betweenness in this case)</span>
<span class="co"># in the original network object</span>
<span class="va">met_orig</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">chaco_net</span><span class="op">)</span>

<span class="co"># Define variables</span>
<span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># How many random simulations to create at each sampling level</span>
<span class="va">props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>, <span class="co"># set sub-sample proportions to test</span>
           <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span>

<span class="co"># Create an output matrix that will receive the results</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nsim</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span>

<span class="co"># Using for loops iterate over every value of props defined above nsim times</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># define a sub-sample at props[j] by retaining nodes from network</span>
    <span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">chaco_net</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span>
                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">chaco_net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Create a network sub-set based on the sample defined above</span>
    <span class="va">sub_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/subgraph.html">induced_subgraph</a></span><span class="op">(</span><span class="va">chaco_net</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">sub_samp</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Calculate betweenness (or any measure of interest) in the sub-set</span>
    <span class="va">temp_stats</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">sub_net</span><span class="op">)</span>
    <span class="co"># Assess Spearman's rho correlation between met_orig and temp_stats</span>
    <span class="co"># and record in the output object at row i and column j.</span>
    <span class="va">output</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">temp_stats</span>,
                                         <span class="va">met_orig</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">sub_samp</span><span class="op">)</span><span class="op">]</span>,
                                         method <span class="op">=</span> <span class="st">'spearman'</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span> <span class="co"># repeat for all values of props, nsim times each</span>


<span class="co"># Visuzlize the results as a boxplot using ggplot.</span>
<span class="co"># Melt wide data format into long data format first.</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Plot visuals</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sub-Sample Size as Proportion of Original"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Spearman's"</span> <span class="op">~</span> <span class="va">rho</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># The lines inside this theme() call are simply</span>
  <span class="co"># there to change the font size of the figure</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<p>The code above worked reasonably well but it would be a bit laborious to modify the code every time we wanted to use a different data set or a different network metric or to consider biased sampling processes. In order to address this issue, we have created a general function called <code>sim_missing_nodes</code> that can replicate the analysis shown in the previous section for more centrality measures (betweenness, degree, or eigenvector) and, as we will see below, can also be used to assess biased sampling processes. The function is essentially structured just like what we saw in the last chunk but with a few additions to assess which measure you plan on using, and to catch other errors.</p>
<p>The function requires the following arguments:</p>
<ul>
<li>
<code>net</code> - An <code>igraph</code> network object which can be undirected, directed, or weighted but must be a one-mode network.</li>
<li>
<code>nsim</code> - The number of random simulated networks to be created at each sampling fraction. The default is 1000.</li>
<li>
<code>props</code> - A vector containing the sampling fractions to consider. Numbers must be in decimal form and be greater than 0 and less than 1. The default is <code>props = c(0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1)</code>. Note that for small networks it is inadvisable to use very small values of <code>props</code>.</li>
<li>
<code>met</code> - This argument is used to define the metric of interest and must be one of: <code>"betweenness"</code>, <code>"degree"</code>, or <code>"eigenvector"</code>. If you do not specify this argument you will receive an error.</li>
<li>
<code>missing_probs</code> - This argument expects a vector that has as many values as there are nodes in the network. Each value should be a probability value between 0 and 1 (inclusive) that a node will be retained in a sub-sample of the network. The default for this argument is <code>NA</code>. If the argument isn’t specified the function assumes you are testing nodes missing at random.</li>
</ul>
<p>Let’s take a look at the code. You can also download <a href="scripts/sim_missing_nodes.R">the script</a> to use it on your own data.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_missing_nodes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">net</span>,
                              <span class="va">nsim</span> <span class="op">=</span> <span class="fl">1000</span>,
                              <span class="va">props</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>,
                                        <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span>,
                              <span class="va">met</span> <span class="op">=</span> <span class="cn">NA</span>,
                              <span class="va">missing_probs</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Initialize required library</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span>
  
  <span class="va">props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">props</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">props</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Variable props must be numeric and be between 0 and 1"</span>,
         call. <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="co"># Select measure of interest based on variable met and calculate</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">met</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"degree"</span>, <span class="st">"betweenness"</span>, <span class="st">"eigenvector"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span>
      <span class="st">"Argument met must be either degree, betweenness, or eigenvector. 
      Check function call."</span>,
      call. <span class="op">=</span> <span class="cn">F</span>
    <span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"degree"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">met_orig</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">else</span>
    <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"betweenness"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">met_orig</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="kw">else</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"eigenvector"</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">met_orig</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/eigen_centrality.html">eigen_centrality</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">$</span><span class="va">vector</span>
        <span class="op">}</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="co"># Create data frame for out put and name columns</span>
  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nsim</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span>
  
  <span class="co"># Iterate over each value of props and then each value from 1 to nsim</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># Run code in brackets if missing_probs == NA</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">missing_probs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span>,
                           size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
        <span class="va">sub_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/subgraph.html">induced_subgraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">sub_samp</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="co"># Run code in brackets if missing_probs contains values</span>
      <span class="kw">else</span> <span class="op">{</span>
        <span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>, prob <span class="op">=</span> <span class="va">missing_probs</span><span class="op">)</span>,
                           size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
        <span class="va">sub_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/subgraph.html">induced_subgraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">sub_samp</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="co"># Select measure of interest based on met and calculate(same as above)</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"degree"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">temp_stats</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">sub_net</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="kw">else</span>
      <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"betweenness"</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">temp_stats</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">sub_net</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw">else</span> <span class="op">{</span>
          <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"eigenvector"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">temp_stats</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/eigen_centrality.html">eigen_centrality</a></span><span class="op">(</span><span class="va">sub_net</span><span class="op">)</span><span class="op">$</span><span class="va">vector</span>
          <span class="op">}</span>
        <span class="op">}</span>
      <span class="op">}</span>
      <span class="co"># Record output for row and column by calculating spearman's rho between</span>
      <span class="co"># met_orig and each temp_stats iteration.</span>
      <span class="va">output</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">temp_stats</span>,
                                           <span class="va">met_orig</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">sub_samp</span><span class="op">)</span><span class="op">]</span>,
                                           method <span class="op">=</span> <span class="st">'spearman'</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="co"># Return output as data.frame </span>
  <span class="va">df_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df_output</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The script is long, but it largely consists of a series of <code>if...else</code> statements that select the appropriate analyses based on the user supplied arguments.</p>
<p>Let’s give this new function a try and calculate eigenvector centrality on the same <code>chaco_net</code> network object. Note that the function above has the <code>melt</code> function built in so the data returned are in a format required to create the plot.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run the function</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">5609</span><span class="op">)</span>
<span class="va">ev_test</span> <span class="op">&lt;-</span> <span class="fu">sim_missing_nodes</span><span class="op">(</span>net <span class="op">=</span> <span class="va">chaco_net</span>, met <span class="op">=</span> <span class="st">"eigenvector"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ev_test</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sub-Sample Size as Proportion of Original"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Spearman's"</span> <span class="op">~</span> <span class="va">rho</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
</div>
<div id="EdgesAtRandom" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Edges Missing at Random<a class="anchor" aria-label="anchor" href="#EdgesAtRandom"><i class="fas fa-link"></i></a>
</h2>
<p>In some cases, we are interested in the potential impact of missing edges rather than missing nodes. For example, if we have created a network of co-presence (based on shared ceramic types, site mentions on monuments, or some other similar data) how robust is our network to the omission of certain edges? How are different centrality metrics influenced by edge omission?</p>
<p>In this section, will conduct an analysis similar to that described above for assessing missing nodes. Specifically, we will sub-sample our networks by removing a fraction of edges and then test the stability of centrality measures and node position across a range of sampling fractions.</p>
<p>The function we defined in the previous only needs to be modified slightly to help assess edges as well. We have created a new function and <a href="scripts/sim_missing_edges.R">associated script file</a> that accomplishes this goal. To give you a peak beneath the hood, here are the primary lines that we needed to change. We replaced the first chunk of code here which creates a sub sample based on <code>vcount</code> or vertex count with a new line that uses <code>ecount</code> or edge count. We then further switched the <code>induced_subgraph</code> and instead used the <code>delete_edges</code> function.</p>
<div class="rmdwarning">
<p>
Note that you should not try to evaluate the chunk of code below as
it contains only portions of the larger functions described here and
will return an error.
</p>
</div>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Code from sim_missing_nodes</span>
<span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>, prob <span class="op">=</span> <span class="va">missing_probs</span><span class="op">)</span>,
                   size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">sub_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/subgraph.html">induced_subgraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">sub_samp</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Replaced code in sim_missing_edges</span>
<span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>, prob <span class="op">=</span> <span class="va">missing_probs</span><span class="op">)</span>,
                           size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">sub_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/delete_edges.html">delete_edges</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span> 
                                             <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sub_samp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s call our new function and assess the impact of edges missing at random on degree centrality to give this a try. We use the same default arguments for <code>nsim</code> and <code>props</code> as we did above. Since we have saved our function as a .R file, we can initialize it using the <code>source</code> function which lets you run all code in a specified .R file.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First initilze the function using the .R script</span>
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"scripts/sim_missing_edges.R"</span><span class="op">)</span>

<span class="co"># Run the function</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">5609</span><span class="op">)</span>
<span class="va">dg_edge_test</span> <span class="op">&lt;-</span> <span class="fu">sim_missing_edges</span><span class="op">(</span>net <span class="op">=</span> <span class="va">chaco_net</span>, met <span class="op">=</span> <span class="st">"degree"</span><span class="op">)</span>

<span class="co"># Visualize the results</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dg_edge_test</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sub-Sample Size as Proportion of Original"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Spearman's"</span> <span class="op">~</span> <span class="va">rho</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
</div>
<div id="IndNodesAtRandom" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Assessing Indivdiual Nodes/Edges<a class="anchor" aria-label="anchor" href="#IndNodesAtRandom"><i class="fas fa-link"></i></a>
</h2>
<p>This sub-section follows along with Chapter 5.3.2 in Brughmans and Peeples (2022). In some cases we may be interested not simply in the robustness of a particular network metric to a specific kind of perturbation across all nodes or edges, but instead in the potential variability of the position or characteristics of a single node (or group of nodes) due to such perturbations. In order to explore individual nodes, we can employ similar procedures to those outlined above with a few additional modifications to our function. In this example we will use the <a href="DataAndWorkspace.html#Cibola">Cibola technological similarity network</a>. As we describe in the book, we want to assess the stability of the position of the Garcia Ranch site. Specifically, we want to know the whether or not the high betweenness centrality value of Garcia Ranch is robust to nodes missing at random in this network.</p>
<p>We define a new function to conduct these analyses below. This function is similar to those used above but instead of providing Spearman’s <span class="math inline">\(/rho\)</span> values it outputs the specific rank order of the node in question across each simulation.</p>
<p>The function requires six pieces of information from the user:</p>
<ul>
<li>
<code>net</code> - An <code>igraph</code> network object. Again this is currently set up for simple networks but could easily be modified.</li>
<li>
<code>target</code> - The name of the <code>target</code> node you wish to assess (exactly as it is written in the network object).</li>
<li>
<code>prop</code> - The proportion of nodes you wish to retain in the test. This should be a single number &gt; 0 and &lt; 1.</li>
<li>
<code>nsim</code> - The number of simulations. The default is 1000.</li>
<li>
<code>met</code> - This argument is used to define the metric of interest and must be one of: <code>"betweenness"</code>, <code>"degree"</code>, or <code>"eigenvector"</code>. If you do not specify this argument you will receive an error.</li>
<li>
<code>missing_probs</code> - This argument expects a vector that has as many values as there are nodes in the network. Each value should be a probability value between 0 and 1 (inclusive) that a node will be retained in a sub-sample of the network. You must include a probability value for the <code>target</code> node though that node will always be retained no matter what value you use. The default for this argument is <code>NA</code>. If the argument isn’t specified the function assumes you are testing nodes missing at random.</li>
</ul>
<p>Briefly how this function works is it first determines which node number corresponds with the <code>target</code> you wish to assess and creates <code>nsim</code> subgraphs that retain that target. The metric of interest is then calculated in each network and the rank order position of the target node in every network is returned. This function can be calculated either as a “missing at random” process by leaving <code>missing_probs</code> set to the default <code>NA</code>.</p>
<p>Let’s take a look at an example. <a href="data/Cibola_edgelist.csv">Use these data</a> to follow along. You can download the <a href="scripts/sim_target_node.R">sim_target_node.R script here</a></p>
<p>First we read in the data:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Read in edgelist file as dataframe and create network object</span>
<span class="va">Cibola_edgelist</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/Cibola_edgelist.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">Cibola_net</span> <span class="op">&lt;-</span>
  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_edgelist.html">graph_from_edgelist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Cibola_edgelist</span><span class="op">)</span>,
                              directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Now lets initialize our function from our script using the <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> function, run the function, and create a bar plot to visualize the results. Following the example in the book, we are assessing the robustness of the rank order position of Garcia Ranch in terms of betweenness centrality to nodes missing at random. Note that Garcia Ranch has the second highest centrality score in the original network:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"scripts/sim_target_node.R"</span><span class="op">)</span>

<span class="co"># Run the function</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">52793</span><span class="op">)</span>
<span class="va">GR</span> <span class="op">&lt;-</span> <span class="fu">sim_target_node</span><span class="op">(</span>
  net <span class="op">=</span> <span class="va">Cibola_net</span>,
  target <span class="op">=</span> <span class="st">"Garcia Ranch"</span>,
  prop <span class="op">=</span> <span class="fl">0.8</span>,
  nsim <span class="op">=</span> <span class="fl">1000</span>,
  met <span class="op">=</span> <span class="st">"betweenness"</span>
<span class="op">)</span>

<span class="co"># Visualize the results</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">GR</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"RankOrder"</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RankOrder</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">" "</span>, x <span class="op">=</span> <span class="st">"Rank Order"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
<p>As we describe in the book, the position of Garcia Ranch as a highly central node appears to be stable to nodes missing at random. Indeed, by far the most common position for this node was 2 which is its position in the original network.</p>
</div>
<div id="MissingBiased" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Nodes/Edges Missing Due to Biased Sampling<a class="anchor" aria-label="anchor" href="#MissingBiased"><i class="fas fa-link"></i></a>
</h2>
<p>This sub-section follows along with Brughmans and Peeples (2022) Chapter 5.3.3. There are many contexts where we are interested in modeling data that are not missing at random but instead are influenced by some biased sampling process. For example, say we have a study area where there have been lots of general reconnaissance surveys that have recorded most of the large sites but few full coverage surveys that have captured smaller sites. In that case, we may wish to model missingness such that small sites would more likely be missing than large sites.</p>
<p>The <code>sim_missing_nodes</code> and <code>sime_missing_edges</code> functions we created above can both help us test the impacts of biased sampling processes. In order to do this we simply use the additional argument <code>missing_probs</code>. This argument requires a vector the same length as the number of nodes or edges, depending on which function you are using. This vector should contain numeric values between 0 and 1 that denote the probabilities that a node or edge will be retained in the sub-sampling effort (and must be in the same order that nodes or edges are recorded in the network object).</p>
<p>Let’s look under the hood to see how this change is implemented in the code. We only need to modify one line of code to include biased sampling processes. In the chunk of code below we have two lines that use the <code>sample</code> function. This function takes a vector of numbers and selects a sample (without replacement by default) of the specified size. If you add the argument <code>prob</code> it will use the vector or probabilities provided to weight the sample. That’s all there is to it.</p>
<div class="rmdwarning">
<p>
The code chunk below is just for the purposes of demonstration and
only represents part of the function so don’t try to evaluate this chunk
or you’ll get an error.
</p>
</div>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Random sampling process</span>
<span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span>, 
                   size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Biased sampling process</span>
<span class="va">sub_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span>, prob <span class="op">=</span> <span class="va">missing_probs</span>,
                   size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">*</span> <span class="va">props</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now, let’s try a real example using the <code>chaco_net</code> data again by creating a random variable to stand in for <code>missing_probs</code> here. We will test the impact on missing nodes. We simply create a vector of 223 random uniform numbers using the <code>runif</code> function to simulate probabilties associated with the 223 nodes. In practice, these probabilities could be based on site size, visibility, or any other feature you choose.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create 233 random numbers between 0 and 1 to stand in for </span>
<span class="co"># node probabilities</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4463</span><span class="op">)</span>
<span class="va">mis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">223</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">mis</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;  [1] 0.6903157 0.9895447 0.3810867 0.2849476 0.2689112</span>
<span class="co">#&gt;  [6] 0.9784197 0.8042309 0.5805580 0.8660900 0.6179489</span>

<span class="co"># Run the function</span>
<span class="va">dg_test</span> <span class="op">&lt;-</span> <span class="fu">sim_missing_nodes</span><span class="op">(</span><span class="va">chaco_net</span>, met <span class="op">=</span> <span class="st">"degree"</span>, missing_probs <span class="op">=</span> <span class="va">mis</span><span class="op">)</span>

<span class="co"># Visualize the results</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dg_test</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sub-Sample Size as Proportion of Original"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Spearman's"</span> <span class="op">~</span> <span class="va">rho</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
<div id="SimIncidence" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Resampling with Incidence Matrices<a class="anchor" aria-label="anchor" href="#SimIncidence"><i class="fas fa-link"></i></a>
</h3>
<p>In the book, we illustrate our approach to biased sampling using the <a href="DataAndWorkspace.html#ArchPubs">co-authorship network</a> data. In this case we start with an incidence matrix of publications and authors and we want to assess the potential impact of missing publications on the network of authors. Since we gathered these data from digital repositories and citations, it is likely that we are missing some publications and it is reasonable to assume that we would be more likely to miss older publications than newer ones given the inclusion of newer publications in searchable digital indexes. Thus, in this example we want to assess missingness such that newer publications are more likely to be retained than older ones in our sample. We compare this to missing at random to assess how these results relate to one another.</p>
<p>First we need to provide two data files. The first is the <a href="data/biblio_attr.csv">bibliographic attribute data</a> which includes date, publication type, and other information on each publication designated by a unique identifier. The second is an <a href="data/biblio_dat2.csv">incidence matrix</a> of publications denoted by unique identifier (rows) and authors (columns). We read this into R and then create an adjacency matrix of author to author connections using matrix algebra (multiply the incidence matrix by the transpose of the incidence matrix), convert it into a <code>igraph</code> network object and then calculate betweenness centrality for all nodes. We plot a simple network node link diagram to visualize these data.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Read in publication and author attribute data</span>
<span class="va">bib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'data/biblio_attr.csv'</span><span class="op">)</span>
<span class="va">bib</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span>
<span class="co">#&gt;        Key      Item.Type</span>
<span class="co">#&gt; 1 FUV8A7JK journalArticle</span>
<span class="co">#&gt; 2 C7MRVHWA    bookSection</span>
<span class="co">#&gt; 3 3EG6T4P6 journalArticle</span>
<span class="co">#&gt;                                                         Publication.Title</span>
<span class="co">#&gt; 1                                    Archaeological Review from Cambridge</span>
<span class="co">#&gt; 2 Network analysis in archaeology. New approaches to regional interaction</span>
<span class="co">#&gt; 3                                                      American Antiquity</span>
<span class="co">#&gt;   Publication.Year          Authors</span>
<span class="co">#&gt; 1             2014       Stoner, Jo</span>
<span class="co">#&gt; 2             2013    Isaksen, Leif</span>
<span class="co">#&gt; 3             1991 Peregrine, Peter</span>
<span class="co"># Read in incidence matrix of publication and author data</span>
<span class="va">bib_dat</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>
    <span class="st">'data/biblio_dat2.csv'</span>,
    header <span class="op">=</span> <span class="cn">T</span>,
    row.names <span class="op">=</span> <span class="fl">1</span>,
    sep <span class="op">=</span> <span class="st">","</span>
  <span class="op">)</span><span class="op">)</span>

<span class="co"># Create adjacency matrix from incidence matrix using matrix algebra</span>
<span class="va">bib_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">bib_dat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">bib_dat</span>
<span class="co"># Convert to igraph network object removing self loops (diag=FALSE)</span>
<span class="va">bib_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="va">bib_adj</span>,
                                               mode <span class="op">=</span> <span class="st">"undirected"</span>,
                                               diag <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># Calculate Betweenness Centrality</span>
<span class="va">bw_all</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">bib_net</span><span class="op">)</span>

<span class="co"># Plot network with nodes scaled based on betweenness</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">346</span><span class="op">)</span>
<span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">bib_net</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">bw_all</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>,
                  fill <span class="op">=</span> <span class="st">'gray'</span>,
                  alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
<p>Although it may at first seem like we could use the same function we used previously to assess missing nodes, there are some key differences in the organization of data in this network that won’t permit that. Specifically, we are interested in nodes (authors) missing at random, but we we want to model probabilities associated with publications. This is a slightly more complicated procedure because the function needs both the network object and the incidence matrix from which it was generated so that the sub-networks can be defined inside the function. We have created a <code>sim_missing_inc</code> function (simulating missing data using an incidence matrix) that conducts this task.</p>
<p>This function requires five specific pieces of information from the user:</p>
<ul>
<li>
<code>net</code> - You must include a network object in <code>igraph</code> format. We use a simple network here but the code could be modified for directed or valued networks.</li>
<li>
<code>inc</code> - You must also include an incidence matrix (as an R matrix object) which describes the relationships between. The incidence matrix needs to have unique row names and column names. The mode you are interested in assessing should be the columns (in other words if you are interested in authors missing at random authors should be represented by columns and publications by rows).</li>
<li>
<code>nsim</code> - You must specify the number of simulations to perform. The default is 1000.</li>
<li>
<code>props</code> - You must specify the proportion of nodes to be retained for each set of <code>nsim</code> runs. This should be provided as a vector of proportions ranging from &gt; 0 to 1. By default, the script will calculate a 0.9 sub-sample all the way down to a 0.1 sub-sample at 0.1 intervals using <code>props=c(0.9,0.8,0.7,0.6,0.5,0.4,0.3,0.2,0.1)</code>.</li>
<li>
<code>lookup_dat</code> - Finally, you need to provide a data frame or matrix that contains two columns. The first column should be the unique name for each row in the incidence matrix (publication key in this case). The second column should include a numeric value between 0 and 1 which indicates the probability that each row will be retained in the resampling process. If you include nothing for <code>missing_probs</code> the function will remove columns at random with an equal probability for each.</li>
</ul>
<p>In our example here, we must first calculate the data we need to provide for the <code>missing_probs</code> argument above. To do this we simply take the vector of publication years in the <code>bib</code> object we read in and rescale them such that the maximum value (most recent publication) equals 1 and older publications are less than 1. This will mean that older publications will more often be removed in our random sub-samples than newer ones as outlined in the example in the book.</p>
<div class="rmdwarning">
<p>
Note that the script provided here is focused on assessing whichever
category of nodes is represented by columns in the original incidence
matrix. You would need to modify this code to use it for an incidence
matrix where rows or your target or simply use the <code><a href="https://rdrr.io/r/base/t.html">t()</a></code>
transpose function to place columns in the target position.
</p>
</div>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a dataframe of all unique combinations of publication code</span>
<span class="co"># and year from attributes data</span>
<span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">bib</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co"># Assign a probability for a publication to be retained inverse to</span>
<span class="co"># the year it was published</span>
<span class="va">lookup_prob</span> <span class="op">&lt;-</span>
  <span class="op">(</span><span class="va">lookup</span><span class="op">$</span><span class="va">Publication.Year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lookup</span><span class="op">$</span><span class="va">Publication.Year</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span>
  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lookup</span><span class="op">$</span><span class="va">Publication.Year</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lookup</span><span class="op">$</span><span class="va">Publication.Year</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create data frame with required output. We have added a sort function</span>
<span class="co"># here to ensure that the order of probabilities in lookup_dat is the </span>
<span class="co"># same as the order of rows in the incidence matrix. You will get </span>
<span class="co"># spurious results if you do not ensure these are the same.</span>
<span class="va">lookup_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Key <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">Key</span>, prob <span class="op">=</span> <span class="va">lookup_prob</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lookup_dat</span><span class="op">)</span>
<span class="co">#&gt;          Key      prob</span>
<span class="co">#&gt; 117 24QNVV37 0.9583333</span>
<span class="co">#&gt; 86  29GVMCNZ 0.0625000</span>
<span class="co">#&gt; 81  2QC8N5RN 1.0000000</span>
<span class="co">#&gt; 112 2QU9ZNUG 0.8125000</span>
<span class="co">#&gt; 126 2T8HPW5E 0.9583333</span>
<span class="co">#&gt; 18  37TC37D2 1.0000000</span></code></pre></div>
<p>With the probabilities of retention for <code>missing_probs</code> in place, we can then call source code for our <a href="scripts/sim_missing_inc.R">sim_missing_inc.R script</a> and run the function. Following the example in the book we run the function for <code>nsim = 1000</code> and for 3 sampling fractions <code>(0.9, 0.8, 0.7)</code> with the metric of interest as <code>betweenness</code>. Let’s first run the function for our “probability by date” biased sampling process.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"scripts/sim_missing_inc.R"</span><span class="op">)</span>

<span class="co"># Run function</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4634</span><span class="op">)</span>
<span class="va">bib_bias</span> <span class="op">&lt;-</span> <span class="fu">sim_missing_inc</span><span class="op">(</span>
  net <span class="op">=</span> <span class="va">bib_net</span>,
  inc <span class="op">=</span> <span class="va">bib_dat</span>,
  missing_probs <span class="op">=</span> <span class="va">lookup_dat</span><span class="op">$</span><span class="va">prob</span>,
  props <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span><span class="op">)</span>,
  met <span class="op">=</span> <span class="st">"betweenness"</span>,
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bib_bias</span><span class="op">)</span>
<span class="co">#&gt;   variable     value</span>
<span class="co">#&gt; 1      0.9 0.9747220</span>
<span class="co">#&gt; 2      0.9 0.9608842</span>
<span class="co">#&gt; 3      0.9 0.9999614</span>
<span class="co">#&gt; 4      0.9 0.9999803</span>
<span class="co">#&gt; 5      0.9 0.9760737</span>
<span class="co">#&gt; 6      0.9 0.9999803</span></code></pre></div>
<p>Next we want to run the function again to simulate nodes missing at random. All we need to do is change the <code>missing_probs</code> argument to <code>NA</code> (or exclude that argument altogether). Let’s run it:</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Run the function</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4363</span><span class="op">)</span>
<span class="va">bib_rand</span> <span class="op">&lt;-</span> <span class="fu">sim_missing_inc</span><span class="op">(</span>
  net <span class="op">=</span> <span class="va">bib_net</span>,
  inc <span class="op">=</span> <span class="va">bib_dat</span>,
  missing_probs <span class="op">=</span> <span class="cn">NA</span>,
  props <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span><span class="op">)</span>,
  met <span class="op">=</span> <span class="st">"betweenness"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bib_rand</span><span class="op">)</span>
<span class="co">#&gt;   variable     value</span>
<span class="co">#&gt; 1      0.9 0.9817859</span>
<span class="co">#&gt; 2      0.9 0.9804552</span>
<span class="co">#&gt; 3      0.9 0.9818085</span>
<span class="co">#&gt; 4      0.9 0.8911948</span>
<span class="co">#&gt; 5      0.9 0.8733779</span>
<span class="co">#&gt; 6      0.9 1.0000000</span></code></pre></div>
<p>Now we can combine the results into a single data frame and plot them as paired box plots for comparison. In order to create paired box plots it is easiest to create a single data frame that contains the results of both runs above. We combine these and add a new column called “Treatment” that specifies for each row in the data frame whether it was part of the Random or Biased sample.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add a variable denoting which sample design it came from</span>
<span class="va">bib_rand</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Random"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bib_rand</span><span class="op">)</span><span class="op">)</span>
<span class="va">bib_bias</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Biased"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bib_bias</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Bind into a single dataframe, convert sampling faction to factor</span>
<span class="co"># and change order of levels for plotting</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">bib_rand</span>, <span class="va">bib_bias</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">variiable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">variable</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0.9"</span>, <span class="st">"0.8"</span>, <span class="st">"0.7"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Plot the results</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sub-Sample Size as Proportion of Original"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Spearman's"</span> <span class="op">~</span> <span class="va">rho</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-19-1.png" width="672"></div>
</div>
</div>
<div id="EdgeProbability" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Edge Probability Modeling<a class="anchor" aria-label="anchor" href="#EdgeProbability"><i class="fas fa-link"></i></a>
</h2>
<p>In this section we take inspiration from some recent work in the area of “Dark Networks” (see Everton 2012) or the investigation of illicit networks. In this field, a number of methods have recently been developed that allow researchers to more directly incorporate assessments of the reliability of specific edges into analyses. This can be done in a number of different ways. Perhaps the most common approach for networks based on data gathered from intelligence sources (such as studies of terrorist networks) is to qualitatively assign different levels of confidence to ties between pairs of actors using an ordinal scale determined based on the source of the information (reliable, usually reliable,… unreliable). This ordinal scale of confidence can then be converted into a probability (from 0 to 1) and that probability value could be used to inform the creation of a range of “possible” networks given the underlying data.</p>
<p>We are not aware of any archaeological examples where edges have been formally qualitatively assigned “confidence levels” in exactly this way, but we think there are potential applications of this method. For example, we could define a network where we assign a low probability of a tie between two archaeological sites if they share an import from a third site/region and a higher probability for a tie between two sites if they share imports from each others’ region. Importantly, such methods can be used to combine information from different sources into a single assessment of the probability of connection.</p>
<p>Since we do not have any data structured in exactly this way, we will use a small simulated data set that consists of and edge list with weights. <a href="data/sim_edge.csv">Use this file</a> to follow along. This is a simple edge list with probability values assigned to each edge at values of 0.2, 0.4, 0.6, 0.8, and 1.0.</p>
<p>Let’s read in the data and plot it:</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Read in edge_list</span>
<span class="va">sim_edge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/sim_edge.csv"</span>,
                     header <span class="op">=</span> <span class="cn">T</span>, row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create network object and assign edge weights and node names</span>
<span class="va">sim_net</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_edgelist.html">graph_from_edgelist</a></span><span class="op">(</span><span class="va">sim_edge</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">sim_net</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="va">sim_edge</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">sim_edge</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">sim_net</span><span class="op">)</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>

<span class="co"># Create color ramp palette</span>
<span class="va">edge_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'gray'</span>, <span class="st">'darkblue'</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

<span class="co"># Plot the resulting network</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4364672</span><span class="op">)</span>
<span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">sim_net</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">sim_net</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>,
                  edge_colour <span class="op">=</span> <span class="va">edge_cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">sim_net</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">*</span> <span class="fl">5</span><span class="op">]</span>,
                  show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">sim_net</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>,
    col <span class="op">=</span> <span class="st">'white'</span>,
    size <span class="op">=</span> <span class="fl">3.5</span>,
    repel <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-20-1.png" width="672"></div>
<p>In the next chunk of code we define a function that iterates over every edge in the simulated network we just created and defines each edge as either present or absent using a simple random binomial with the probability set by the edge weight as described above. The output of this function (<code>edge_prob</code>) is a list object that contains <code>nsim</code> <code>igraph</code> network objects that are candidate networks of the original.</p>
<p>In order to extract values of interest from these candidate networks, we created another function called <code>compile_stat</code>. This function iterates over all <code>nsim</code> networks in the <code>net_list</code> list object and calculates the centrality metric of interest in this case returning the results as a simple matrix. It is then possible to compare things like average degree or the distribution of degree for particular nodes across all of the candidate networks. We have placed these two functions in an additional script file called <a href="scripts/edge_prob">edge_prob.R</a> which you can download to use and modify on your own.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define function for assessing and retaining edges based on edge</span>
<span class="co"># weight probabilities</span>
<span class="va">edge_prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">net</span>, <span class="va">nsim</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">probs</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">net_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">sub_set</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">sub_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sub_set</span>, <span class="va">j</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">net_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>
      <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/delete_edges.html">delete_edges</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span>
        <span class="va">net</span>
      <span class="op">)</span><span class="op">)</span>
      <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sub_set</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Define function for assessing statistic of interest</span>
<span class="va">compile_stat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">net_list</span>, <span class="va">met</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gorder.html">vcount</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Select measure of interest based on met and calculate(same as above)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"degree"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">out</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">else</span>
    <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"betweenness"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">out</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="kw">else</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">met</span> <span class="op">==</span> <span class="st">"eigenvector"</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">out</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/eigen_centrality.html">eigen_centrality</a></span><span class="op">(</span><span class="va">net_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">vector</span>
        <span class="op">}</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now we run the edge_prob function for <code>nsim = 1000</code> and display a few candidate networks.</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EL_test</span> <span class="op">&lt;-</span> <span class="fu">edge_prob</span><span class="op">(</span><span class="va">sim_net</span>, nsim <span class="op">=</span> <span class="fl">1000</span>, probs <span class="op">=</span> <span class="va">sim_edge</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9651</span><span class="op">)</span>
<span class="va">comp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,
                  edge_colour <span class="op">=</span> <span class="va">edge_cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">*</span> <span class="fl">5</span><span class="op">]</span>,
                  show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>,
    col <span class="op">=</span> <span class="st">'white'</span>,
    size <span class="op">=</span> <span class="fl">2.5</span>,
    repel <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">comp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,
                  edge_colour <span class="op">=</span> <span class="va">edge_cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">*</span> <span class="fl">5</span><span class="op">]</span>,
                  show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>,
    col <span class="op">=</span> <span class="st">'white'</span>,
    size <span class="op">=</span> <span class="fl">2.5</span>,
    repel <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">comp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,
                  edge_colour <span class="op">=</span> <span class="va">edge_cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">*</span> <span class="fl">5</span><span class="op">]</span>,
                  show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">EL_test</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>,
    col <span class="op">=</span> <span class="st">'white'</span>,
    size <span class="op">=</span> <span class="fl">2.5</span>,
    repel <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">comp1</span>, <span class="va">comp2</span>, <span class="va">comp3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-22-1.png" width="672"></div>
<p>We then use the <code>compile_stat</code> function to assess degree centrality for one particular node, displaying a histogram of values with mean indicated.</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dg_stat</span> <span class="op">&lt;-</span> <span class="fu">compile_stat</span><span class="op">(</span><span class="va">EL_test</span>, met <span class="op">=</span> <span class="st">"degree"</span><span class="op">)</span>

<span class="va">dg_20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>val <span class="op">=</span> <span class="va">dg_stat</span><span class="op">[</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dg_20</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Degree Centrality of Node 20"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dg_20</span><span class="op">$</span><span class="va">val</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-23-1.png" width="672"></div>
<div id="EdgeProbSim" class="section level3" number="4.7.1">
<h3>
<span class="header-section-number">4.7.1</span> Edge Probability and Similarity Networks<a class="anchor" aria-label="anchor" href="#EdgeProbSim"><i class="fas fa-link"></i></a>
</h3>
<p>One area of archaeological network research where the edge probability modeling approach outlined above may be of use relates to similarity networks. Many similarity networks used in archaeology are built such that the edge weights are scaled between 0 and 1. These edge weights could be thought of as “probabilities” just as we saw with the simulated example above. Indeed, this conforms with the frequent interpretation of similarity values as relating to probabilities of interaction in numerous network studies (e.g., Mills et al. 2013a, 2013b, 2015; Golitko and Feinman 2015; Golitko et al. 2012, etc.).</p>
<p>Let’s take a look at an example using a weighted similarity network generated using the <a href="DataAndWorkspace.html#Cibola">Cibola technological similarity data</a> used above. Download the <a href="data/Cibola_wt.RData">RData file here</a> to follow along.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/Cibola_wt.RData"</span><span class="op">)</span>

<span class="co"># View first few edge weights in network object</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">Cibola_wt</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;  [1] 0.7050691 0.7757143 0.8348214 0.8656783 0.8028571</span>
<span class="co">#&gt;  [6] 0.7329193 0.7509158 0.8441558 0.7857143 0.8102919</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4446347</span><span class="op">)</span>
<span class="va">sim_nets</span> <span class="op">&lt;-</span> <span class="fu">edge_prob</span><span class="op">(</span><span class="va">Cibola_wt</span>, nsim <span class="op">=</span> <span class="fl">1000</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html">E</a></span><span class="op">(</span><span class="va">Cibola_wt</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></code></pre></div>
<p>Now let’s plot a couple of the candidate networks:</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Precompute layout</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9631</span><span class="op">)</span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/layout_with_fr.html">layout_with_fr</a></span><span class="op">(</span><span class="va">Cibola_wt</span><span class="op">)</span>

<span class="co"># Example 1</span>
<span class="va">comp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                layout <span class="op">=</span> <span class="st">"manual"</span>,
                x <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,
                y <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Example 2</span>
<span class="va">comp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                layout <span class="op">=</span> <span class="st">"manual"</span>,
                x <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,
                y <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Example 3</span>
<span class="va">comp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                layout <span class="op">=</span> <span class="st">"manual"</span>,
                x <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,
                y <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,
                  size <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span>,
                  fill <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">comp1</span>, <span class="va">comp2</span>, <span class="va">comp3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-25-1.png" width="672"></div>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bw_test</span> <span class="op">&lt;-</span> <span class="fu">compile_stat</span><span class="op">(</span><span class="va">sim_nets</span>, met <span class="op">=</span> <span class="st">"betweenness"</span><span class="op">)</span>

<span class="va">bw_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>val <span class="op">=</span> <span class="va">bw_test</span><span class="op">[</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bw_10</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Betweenness Centrality of Node 10"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bw_10</span><span class="op">$</span><span class="va">val</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with</span>
<span class="co">#&gt; `binwidth`.</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-26-1.png" width="672"></div>
</div>
</div>
<div id="SampleSize" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Uncertainty Due to Small or Variable Sample Size<a class="anchor" aria-label="anchor" href="#SampleSize"><i class="fas fa-link"></i></a>
</h2>
<p>This section follows Brughmans and Peeples (2022) Chapter 5.3.5 to provide an example of how you can use the simulation approach outlined here to assess sampling variability in the frequency data underlying archaeological networks. In this example, we use apportioned ceramic frequency data from the Chaco World portion of the <a href="DataAndWorkspace.html#SWSN">Southwest Social Networks database</a>. You can <a href="data/AD1050cer.csv">download the data here</a> to follow along.</p>
<p>The goal of this sub-section is to illustrate how you can use a bootstrappping approach to assess variability in network properties based on sampling error in the raw data underlying archaeological networks. In our example based on ceramic similarity networks here this involves creating a large number of random replicates of each row of our raw ceramic data with sample size held constant (as the observed sample size for that site) and with the probabilities that a given sherd will be a given type determined by the underlying multinomial frequency distribution of types at that site. In other words, we pull a bunch of random samples from the site with the probability that a given sample is a given type determined by the relative frequency of that type in the actual data. Once this procedure has been completed, we can then assess centrality metrics or any other graph, node, or edge level property and determine the degree to which absolute values and relative ranks are potentially influenced by sampling error.</p>
<p>There are many ways to set up such a resampling procedure and many complications (for example, how do we deal with limited diversity of small samples?). For the purposes of illustration here, we will implement a very simple procedure where we simply generate new samples of a fixed size based on our observed data and determine the degree to which our network measures are robust to this perturbation. In the chunk of code below we create 1000 replicates based on our original ceramic data.</p>
<p>The following chunk of code first reads in the ceramic data, converts it to a Brainerd-Robinson similarity matrix and then defines a function called <code>sim_samp_error</code> which creates <code>nsim</code> random replicates of the ceramic data, converts them to similarity matrices, and outputs those results as a list object. You can <a href="scripts/sim_samp_error.R">download the script for the fucnction below here</a>.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Read in raw ceramic data</span>
<span class="va">ceramic</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/AD1050cer.csv"</span>,
           header <span class="op">=</span> <span class="cn">TRUE</span>,
           row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># Convert to proportion</span>
<span class="va">ceramic_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">ceramic</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># Convert to Brainerd-Robinson similarity matrix</span>
<span class="va">ceramic_BR</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">ceramic_p</span>,
                                            method <span class="op">=</span> <span class="st">'manhattan'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>

<span class="co"># Create function for assessing impact of sampling error on</span>
<span class="co"># weighted degree for similarity network</span>
<span class="va">sim_samp_error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cer</span>, <span class="va">nsim</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">data_sim</span> <span class="op">&lt;-</span>  <span class="cn">NULL</span>
    <span class="co"># the for-loop below creates a random multinomial replicate</span>
    <span class="co"># of the ceramic data</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cer</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">data_sim</span> <span class="op">&lt;-</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">data_sim</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">cer</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, prob <span class="op">=</span> <span class="va">cer</span><span class="op">[</span><span class="va">j</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="co"># Convert simulated data to proportion, create similarity matrix,</span>
    <span class="co"># calculate degree, and assess correlation</span>
    <span class="va">temp_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data_sim</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">sim_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">temp_p</span>,
                                                   method <span class="op">=</span> <span class="st">'manhattan'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span>
      <span class="fl">2</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The following chunk of code runs the <code>sim_samp_error</code> function defined above for our Chaco ceramic data and then defines a new function called <code>sim_cor</code> which takes the output of <code>sim_samp_error</code> and the original ceramic similarity matrix (<code>ceramic_BR</code>) and calculates weighted degree centrality and the Speraman’s <span class="math inline">\(\rho\)</span> correlations between the original similarity matrix and each random replicate. This <code>sim_cor</code> script could be modified to use any network metric that outputs a vector. Once these results are returned we visualize the results as a histogram.</p>
<p>Note that this could take several seconds to a few minutes depending on your computer.</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4634</span><span class="op">)</span>
<span class="va">sim_nets</span> <span class="op">&lt;-</span> <span class="fu">sim_samp_error</span><span class="op">(</span>cer <span class="op">=</span> <span class="va">ceramic</span>, nsim <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="va">sim_cor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim_nets</span>, <span class="va">sim</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># change this line to use a different metric</span>
  <span class="va">dg_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span>
  <span class="va">dg_cor</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># change this line to use a different metric</span>
    <span class="va">dg_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">dg_cor</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dg_orig</span>, <span class="va">dg_temp</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dg_cor</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">dg_cor</span> <span class="op">&lt;-</span> <span class="fu">sim_cor</span><span class="op">(</span><span class="va">sim_nets</span>, <span class="va">ceramic_BR</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dg_cor</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dg_cor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">'white'</span>, fill <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Correlation in Degree Centraility'</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-28-1.png" width="672"></div>
<p>As described in Chapter 5.3.5, in some cases we want to observe patterns of variation due to sampling error for individual sites or sets of sites. In the next chunk of code we illustrate how to produce figure 5.14 from the Brughmans and Peeples (2022) book. Specifically, this plot consists of a series of line plots where the x axis represents each node in the network ordered by degree centrality in the original observed network. For each node there is a vertical line which represents the 95% confidence interval around degree across the <code>nsim</code> random replicates produced to evaluate sampling error. The blue line represents degree in the original network and the red line represents median degree in the resampled networks.</p>
<p>To create this plot, we first iterate through every object in <code>sim_nets</code> and calculate weighted degree centrality and then add that to a two-column matrix along with a node id. Once we have done this for all simulations, we use the <code>summarise</code> function to calculate the Mean and</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create data frame containing degree and site id for nsim random</span>
<span class="co"># similarity matrices</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># define empty matrix</span>
<span class="co"># calculate degree centrality for each random run and bind in</span>
<span class="co"># matrix along with id</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">sim_nets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">temp</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span> <span class="co"># remove first row in initial matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="st">"degree"</span><span class="op">)</span> <span class="co"># add column names</span>

<span class="co"># Use summarise function to create median, confidence intervals,</span>
<span class="co"># and other statistics for degree by site.</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span>,
    Median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span>,
    Max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span>,
    Min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span>,
    Conf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.96</span>
  <span class="op">)</span>
<span class="va">out</span><span class="op">$</span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">site</span><span class="op">)</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">ceramic_BR</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>

<span class="co"># Create dataframe of degree centrality for the original ceramic</span>
<span class="co"># similarity matrix</span>
<span class="va">dg_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">ceramic_BR</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dg_wt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"dg.wt"</span>

<span class="co"># Plot the results</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">out</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">Median</span><span class="op">)</span>,
      y <span class="op">=</span> <span class="va">Median</span>,
      group <span class="op">=</span> <span class="fl">1</span>
    <span class="op">)</span>,
    col <span class="op">=</span> <span class="st">'red'</span>,
    lwd <span class="op">=</span> <span class="fl">1.5</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">Median</span><span class="op">)</span>,
    ymin <span class="op">=</span> <span class="va">Median</span> <span class="op">-</span> <span class="va">Conf</span>,
    ymax <span class="op">=</span> <span class="va">Median</span> <span class="op">+</span> <span class="va">Conf</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">dg_wt</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">dg.wt</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">dg.wt</span><span class="op">)</span>,
    col <span class="op">=</span> <span class="st">'blue'</span>,
    lwd <span class="op">=</span> <span class="fl">1.5</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">'Degree'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Sites in Rank Order of Degree'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-uncertainty_files/figure-html/unnamed-chunk-29-1.png" width="672"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="Exploratory.html"><span class="header-section-number">3</span> Exploratory Network Analysis</a></div>
<div class="next"><a href="Visualization.html"><span class="header-section-number">5</span> Network Visualization</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#Uncertainty"><span class="header-section-number">4</span> Quantifying Uncertainty</a></li>
<li><a class="nav-link" href="#UncertaintyScripts"><span class="header-section-number">4.1</span> R Scripts and Custom Functions</a></li>
<li><a class="nav-link" href="#UncertaintyGeneral"><span class="header-section-number">4.2</span> A General Approach to Uncertainty</a></li>
<li><a class="nav-link" href="#NodesAtRandom"><span class="header-section-number">4.3</span> Nodes Missing at Random</a></li>
<li><a class="nav-link" href="#EdgesAtRandom"><span class="header-section-number">4.4</span> Edges Missing at Random</a></li>
<li><a class="nav-link" href="#IndNodesAtRandom"><span class="header-section-number">4.5</span> Assessing Indivdiual Nodes/Edges</a></li>
<li>
<a class="nav-link" href="#MissingBiased"><span class="header-section-number">4.6</span> Nodes/Edges Missing Due to Biased Sampling</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#SimIncidence"><span class="header-section-number">4.6.1</span> Resampling with Incidence Matrices</a></li></ul>
</li>
<li>
<a class="nav-link" href="#EdgeProbability"><span class="header-section-number">4.7</span> Edge Probability Modeling</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#EdgeProbSim"><span class="header-section-number">4.7.1</span> Edge Probability and Similarity Networks</a></li></ul>
</li>
<li><a class="nav-link" href="#SampleSize"><span class="header-section-number">4.8</span> Uncertainty Due to Small or Variable Sample Size</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mpeeples2008/Archaeological_Network_Science/blob/master/04-uncertainty.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mpeeples2008/Archaeological_Network_Science/edit/master/04-uncertainty.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Online Companion to <em>Archaeological Network Science</em></strong>" was written by Matthew A. Peeples and Tom Brughmans. It was last built on 2022-05-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
